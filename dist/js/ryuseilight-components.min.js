/*!
 * RyuseiLight.js
 * Version  : 0.0.13
 * License  : MIT
 * Copyright: 2020 Naotoshi Fujita
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).RyuseiLight=e()}(this,(function(){"use strict";var t="keyword",e="comment",n="selector",i="prop",r="cdata",o="prolog",a="string",s="number",c="function",u="operator",l="bracket",f="delimiter",d="space",p="text";function v(t){return null!==t&&"object"==typeof t}function m(t){return Array.isArray(t)}function h(t){return"string"==typeof t}function g(t){return void 0===t}function y(t){return t instanceof HTMLElement}function b(t){return m(t)?t:[t]}function _(t,e){b(e).forEach((function(e){e&&t.classList.add(e)}))}function k(t,e){e=b(e);for(var n=0;n<e.length;n++)t.appendChild(e[n])}function x(t,e){for(var n=Object.keys(t),i=0;i<n.length;i++)e(t[n[i]],n[i])}function S(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return n.forEach((function(e){x(e,(function(n,i){g(e[i])||(t[i]=e[i])}))})),t}function w(t,e){if(h(e))return t.getAttribute(e)||"";v(e)&&x(e,(function(e,n){t.setAttribute(n,String(e))}))}function A(t,e){return void 0===e&&(e=document),e.querySelector(t)}function L(t,e){x(e,(function(e,n){t.style[n]=String(e)}))}function E(t,e){if(g(e))return t.textContent;t.textContent=e}function F(t,e){if(void 0===e&&(e=""),!t)throw new Error(e)}var z="ryuseilight";function j(t,e){return t.charAt(0)===e}var T=!g(/x/.sticky),C=function(){function t(t){this.language=t,this.init(t)}var e=t.prototype;return e.init=function(t){var e=this;x(t.grammar,(function(n,i){t.grammar[i]=e.merge(t,n)})),t.use=t.use||{},x(t.use,this.init.bind(this))},e.merge=function(t,e){var n=this;return e.reduce((function(e,i){var r=i[0],o=i[1];if(j(r,"#")&&!o){var a=t.grammar[r.slice(1)];F(a),e.push.apply(e,n.merge(t,a))}else{var s=function(t){return t.toString().match(/[gimsy]*$/)[0]}(o).replace(/[gy]/g,"");i[1]=T?new RegExp(o.source,"y"+s):new RegExp(o.source+"|()","g"+s),e.push(i)}return e}),[])},e.tokenizeBy=function(t,e,n){var i=0,r=0;t:for(;i<t.length;){for(var o=0;o<n.length;o++){var a=n[o],s=a[1],c=a[2];s.lastIndex=i;var u=s.exec(t);if(u&&u[0]){if(r<i&&this.push([p,t.slice(r,i)]),"@back"===c){r=i;break t}if(r=i+=this.handle(u,e,n[o])||1,"@break"===c)break t;continue t}}i++}return r<i&&this.push([p,t.slice(r)]),i},e.push=function(t){for(var e,n=t[0],i=0,r=t[1];(e=r.indexOf("\n",i))>-1;)i<e&&this.lines[this.index].push([n,r.slice(i,e)]),i=e+1,this.lines[++this.index]=[];(r=r.slice(i))&&this.lines[this.index].push([n,r])},e.handle=function(t,e,n){var i=n[0],r=0;if(i){var o=t[0];if(j(i,"@")){var a=e.use[i.slice(1)];return F(a),this.tokenizeBy(o,a,a.grammar.main)}if(j(i,"#")){var s=e.grammar[i.slice(1)];F(s);var c="@rest"===n[2]?t.input.slice(t.index):o;return this.tokenizeBy(c,e,s)}r=o.length,this.push([i,o])}return r},e.tokenize=function(t){return this.lines=[[]],this.index=0,this.tokenizeBy(t,this.language,this.language.grammar.main),this.lines},t}(),R=function(){function t(){this.handlers={}}var e=t.prototype;return e.on=function(t,e){(this.handlers[t]=this.handlers[t]||[]).push({callback:e})},e.emit=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];(this.handlers[t]||[]).forEach((function(t){t.callback.apply(t,n)}))},e.destroy=function(){this.handlers={}},t}(),H={root:z,container:"rl__container",body:"rl__body",code:"rl__code",line:"rl__line",token:"rl__token",active:"is-active"},$={},D=function(){function t(t,e,n,i){void 0===i&&(i={}),this.lines=[],this.event=new R,this.lines=t,this.info=e,this.root=n,this.options=i,this.init()}t.compose=function(t){x(t,(function(t,e){$[e]||($[e]=t)}))};var e=t.prototype;return e.init=function(){var t=this,e=this.lines;if(e.length){var n=e[e.length-1];n.length&&(1!==n.length||n[0][1].trim())||e.pop()}x($,(function(e){e(t)})),this.event.emit("mounted",this)},e.renderLines=function(t){for(var e=this.event,n=this.options.span?"span":"code",i=0;i<this.lines.length;i++){var r=this.lines[i],o=[H.line];if(e.emit("line:open",t,o,i),t('<div class="'+o.join(" ")+'">'),r.length)for(var a=0;a<r.length;a++){var s=r[a],c=[H.token+" "+"rl__"+s[0]];e.emit("token",s,c),t("<"+n+' class="'+c.join(" ")+'">'+(s[1].replace(/&/g,"&amp;").replace(/</g,"&lt;")+"</")+n+">")}else t("\n");t("</div>"),e.emit("line:closed",t,i)}},e.html=function(t){void 0===t&&(t=!0);var e=this.event,n="",i=function(t){n+=t};t&&(n+='<pre class="'+H.root+" "+H.root+"--"+this.info.id+'">');var r=[H.container];e.emit("open",i,r),n+='<div class="'+r.join(" ")+'">',e.emit("opened",i);var o=[H.body+(this.options.wrap?" "+H.body+"--wrap":"")];return e.emit("body:open",i,o),n+='<div class="'+o.join(" ")+'">',e.emit("body:opened",i),n+='<div class="'+H.code+'">',this.renderLines(i),n+="</div>",e.emit("body:close",i),n+="</div>",e.emit("close",i),n+="</div>",e.emit("closed",i),t&&(n+="</pre>"),n},e.destroy=function(){this.event.emit("destroy"),this.event.destroy()},t}(),B=/\b\w+(?= *\()/,M=/[+-]?(\d+\.?\d*|\d*\.?\d+)([eE][+-]?\d+)?/,N=/\b(?:true|false)\b/,O=/[[\]{}()]/,Z=/[ \t]+/,q=/'(?:\\'|.)*?'/,I=/"(?:\\"|.)*?"/,J=/\/\*[\s\S]*?\*\//,P=/\/\/.*/;function G(){return{id:"common",name:"",grammar:{main:[[a,q],[a,I],[e,J],[e,P],[t,/\b(?:break|catch|class|continue|do|else|extends|finally|for|function|if|implements|in|instanceof|interface|new|null|return|throw|trait|try|while)\b/],["class",/\b[A-Z][\w$]*\b/],[c,B],["boolean",N],["identifier",/\b[a-z_$][\w$]*\b/],[s,M],[u,/\+[+=]?|-[-=]?|\*\*?=?|\/=?|%=?|&&?=?|\|\|?=?|\?\??=?|<<?=?|>>?=?|[!=]=?=?|[~:^]/],[l,O],[f,/[;.,]+/],[d,Z]]}}}function U(){return{id:"css",name:"CSS",grammar:{main:[["#common"],["#findBlock"],["#findAtrule"]],findBlock:[["#block",/(?:(?![\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])[\s\S])(?:(?![;\{\}])[\s\S])+\{[\s\S]*?\}/,"@rest"]],findAtrule:[["#atrule",/@[0-9A-Z_a-z][\s\S]+?(;|(?=[\{\}]))/]],findSelector:[["#selector",/(?:(?![\t-\r \/;\{\}\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])[\s\S])[\s\S]*?(?=\{)/]],common:[[a,/(["'])[\s\S]*?(?:(?!\\)[\s\S])\1/],[e,J],[d,Z]],block:[["#findAtrule"],["#findSelector"],["#inner",/{/,"@rest"],[l,/}/,"@break"],[d,Z]],inner:[[l,/{/],["#common"],["#findBlock"],["#props"],["#findAtrule"],["",/}/,"@back"]],atrule:[["#common"],["#url",/\burl\(/,"@rest"],[d,Z],[t,/[^\s();]+/],[f,/[:;,]/],["#paren",/\(/,"@rest"]],paren:[[l,/^\(/],["#common"],["#paren",/\(/,"@rest"],[l,/\)/,"@break"],["#props"]],selector:[["#common"],[u,/[>+~]/],[l,/[[\]()]/],[f,/=/],[n,/::?\S+/],[n,/[\W\d]\S+/],["tag",/\b[a-zA-Z]+|\*/],[n,/\S+/]],url:[["#common"],[c,/^url/],[l,/\(/],[a,/[^)]+/],[l,/\)/,"@break"]],props:[[i,/[a-z0-9-]+(?=:)/i],["#url",/\burl\(/,"@rest"],[c,/\b[\w-]+(?=\()\b/],[t,/!important|\b(?:initial|inherit|unset)/],[i,/[a-z0-9-]+(?=:)/],[s,/#([0-9a-f]{6}|[0-9a-f]{3})/i],[s,/\bU\+[0-9a-f?-]+/i],[s,/[+-]?(\d+\.?\d*|\d*\.?\d+)/],[f,/[:;,]/],["#paren",/\(/,"@rest"],[l,/[[\])]/],[d,Z]]}}}function W(){var e,n,i,r=S(G(),{id:"javascript",name:"JavaScript",alias:["js"]}),o=r.grammar,s=o.main;return n=[["regexp",/\/(\[.*[^\\]?]|\\\/|.)+?\/[gimsuy]*/],[t,/\b(?:as|async|await|case|catch|const|debugger|default|delete|enum|export|from|import|let|package|private|protected|public|super|switch|static|this|typeof|undefined|var|void|with|yield)\b/],[t,/\b((get|set)(?= *\S+\(\)))/],["#backtick",/`/,"@rest"],["decorator",/@[^\s(@]+/]],(i=function(t,e){for(var n=0;n<t.length;n++)if(t[n][0]===e)return n;return-1}(e=s,t))>-1?e.splice.apply(e,[i,0].concat(n)):e.push.apply(e,n),S(o,{backtick:[[a,/^`/],[a,/(\$[^{]|\\[$`]|[^`$])+/],["#expression",/\${/,"@rest"],[a,/`/,"@break"]],expression:[[l,/^\${/],[l,/}/,"@break"],["#main"]]}),r}function X(){var t=W(),n=U(),i=[r,/<!\[CDATA\[[\s\S]*\]\]>/i];return t.grammar.main.unshift(i),n.grammar.main.unshift(i),{id:"html",alias:["markup"],name:"HTML",use:{javascript:t,css:n},grammar:{main:[[e,/<!\x2D\x2D[\s\S]*?\x2D\x2D>/],[o,/<!DOCTYPE.*?>/],i,["#script",/<script[\s\S]*?>[\s\S]*?<\/script>/],["#style",/<style[\s\S]*?>[\s\S]*?<\/style>/],["#tag",/<[\s\S]*?>/],["entity",/&[\da-z]+;|&#\d+;/i]],cdata:[[r,/<!\[CDATA\[[\s\S]*\]\]>/i]],script:[["#tag",/^<script[\s\S]*?>/],["#cdata"],["@javascript",/[\s\S]+(?=<\/script>)/],["#tag",/<\/script>/]],style:[["#tag",/^<style[\s\S]*?>/],["@css",/[\s\S]+(?=<\/style>)/],["#tag",/<\/style>/]],tag:[["#attr",/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+[\s\S]+(?=[\t-\r \/>\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/],["tag",/[^\s/<>"'=]+/],[l,/[<>]/],[f,/[/]/]],attr:[[d,Z],["value",/(['"])(\\\1|.)*?\1/],[f,/[/=]/],["attr",/[^\s/>"'=]+/]]}}}var Y={},K=function(){function t(t){void 0===t&&(t={}),this.renderers=[],this.options=S({},t)}t.register=function(t){b(t).forEach((function(t){var e=t.id;if(e&&!Y[e]){var n=new C(t);(t.alias||[]).concat(e).forEach((function(t){Y[t]=n}))}}))},t.tokenize=function(e,n){return t.getLexer(n).tokenize(e)},t.getLexer=function(e){return Y.none||t.register({id:"none",name:"",grammar:{main:[]}}),Y[e]||Y.none};var e=t.prototype;return e.getRenderer=function(e,n,i){void 0===i&&(i={});var r=(i=S({},this.options,i)).language,o=t.getLexer(r).language,a=o.name,s=o.id;return new D(t.tokenize(e,r),{name:a,id:s},n,i)},e.apply=function(t,e){void 0===e&&(e={});for(var n=h(t)?document.querySelectorAll(t):[t],i=0;i<n.length;i++){var r=n[i];if(y(r)){var o=S({},e,{language:w(r,"data-rl-language")||void 0}),a=this.getRenderer(E(r),r,o),s=r instanceof HTMLPreElement;s&&_(r,[H.root,H.root+"--"+a.info.id]),r.innerHTML=a.html(!s),a.event.emit("applied",r),this.renderers.push(a)}}},e.html=function(t,e){return void 0===e&&(e={}),F(h(t),"Invalid code."),this.getRenderer(t,null,e).html()},e.destroy=function(){this.renderers.forEach((function(t){t.destroy()}))},t}();K.compose=D.compose;var Q="data-rl-active-lines";var V={html:"Copy",activeHtml:"Done",duration:1e3,ariaLabel:"Copy code to clipboard"};function tt(t,e){var n,i,r,o,a,s=(n="textarea",o=document.createElement(n),i&&_(o,i),r&&k(r,o),o);s.textContent=t,L(s,{position:"absolute",left:"-99999px"}),k(document.body,s),s.focus(),s.select();try{document.execCommand("copy")}catch(t){alert("Failed to copy."),a=!0}document.body.removeChild(s),a||e()}var et,nt=Object.freeze({__proto__:null,ActiveLines:function(t){var e=t.event,n=t.root,i=t.options,r=n&&function(t){var e=w(t,Q);if(e)try{return JSON.parse(e)}catch(t){n=t.message,console.error("[ryuseilight] "+n)}var n}(n)||i.activeLines;if(m(r)){var o=function(t){var e=[];return t.forEach((function(t){m(t)||(t=[t,t]);for(var n=(+t[0]||1)-1,i=(+t[1]||1)-1,r=n;r<=i;r++)e[r]=H.active})),e}(r);e.on("gutter:row:open",(function(t,e,n){o[n]&&e.push(o[n])})),e.on("line:open",(function(t,e,n){o[n]&&e.push(o[n])}))}},Copy:function(t){var e=t.lines,n=t.event,i=t.options;if(i.copy){var r=S({},V,v(i.copy)?i.copy:{}),o="rl__button__label";i.tools=!0,n.on("overlay:tools",(function(t){t('<button type="button" class="rl__button rl__copy" aria-label="Copy code to clipboard">'),t('<span class="'+o+" "+o+'--inactive">'+r.html+"</span>"),t('<span class="'+o+" "+o+'--active">'+r.activeHtml+"</span>"),t("</button>")})),n.on("applied",(function(t){var i=A(".rl__copy",t),o=e.map((function(t){return t.map((function(t){return t[1]})).join("")})).join("\n");if(i){var a=function(){!function(t,e,n){var i=function(){n&&function(t,e){_(t,H.active);var n="_rlTimer";t[n]&&clearTimeout(t[n]);t[n]=setTimeout((function(){t.classList.remove(H.active)}),e)}(e,n)};navigator.clipboard?navigator.clipboard.writeText(t).then(i).catch((function(){return tt(t,i)})):tt(t,i)}(o,i,r.duration)};i.addEventListener("click",a),n.on("destroy",(function(){i.removeEventListener("click",a)}))}}))}},Gutter:function(t){var e=t.lines,n=t.event,i=t.root,r=t.options;n.on("mounted",(function(){var t,o,a;r.gutter&&(n.on("open",(function(t,e){e.push("has-gutter")})),n.on("body:opened",(function(t){t('<div class="rl__gutter" aria-hidden="true">');for(var i=0;i<e.length;i++){var r=["rl__gutter__row"];n.emit("gutter:row:open",t,r,i),t('<div class="'+r.join(" ")+'">'),n.emit("gutter:row:opened",t,i),t("</div>")}t("</div>")})),i&&"undefined"!=typeof window&&(window.addEventListener("resize",(t=s,o=100,function(){a||(a=setTimeout((function(){t(),a=null}),o))})),s(),n.on("destroy",(function(){window.removeEventListener("resize",s)}))));function s(){var t=A(".rl__gutter",i),e=A("."+H.code,i);if(t&&e)for(var n=0;n<e.children.length;n++){var r=t.children[n],o=e.children[n];y(r)&&r.clientHeight!==o.clientHeight&&L(r,{height:o.clientHeight+"px"})}}}))},LanguageName:function(t){var e=t.event,n=t.info,i=t.options,r=n.name;if(i.languageName&&r){var o="topLeft"===i.languageName?"topLeft":"topRight";i.overlay=i.overlay||{},i.overlay[o]=!0,e.on("overlay:"+o,(function(t){t('<span class="rl__name">'+n.name+"</span>")}))}},LineNumbers:function(t){var e=t.root,n=t.event,i=t.options,r=e?w(e,"data-rl-line-numbers"):"",o=""===r?+i.lineNumbers:+r;if(o||0===o){i.gutter=!0;var a=Math.floor(o)-1;n.on("gutter:row:opened",(function(t,e){t('<span class="rl__line-number">'+(e+1+a)+"</span>")}))}},Overlay:function(t){var e=t.event,n=t.options;e.on("mounted",(function(){var t=n.overlay,i=void 0===t?{}:t;(i.topRight||n.tools)&&e.on("close",(function(t){t('<div class="rl__overlay rl__overlay--top-right">'),e.emit("overlay:topRight",t),n.tools&&(t('<span class="rl__tools">'),e.emit("overlay:tools",t),t("</span>")),t("</div>")})),i.topLeft&&e.on("close",(function(t){t('<div class="rl__overlay rl__overlay--top-left">'),e.emit("overlay:topLeft",t),t("</div>")})),(i.topRight||i.topLeft)&&e.on("open",(function(t,e){e.push("has-top-overlay")}))}))},Title:function(t){var e=t.event,n=t.root,i=t.options,r=n&&w(n,"data-rl-title")||i.title;r&&e.on("open",(function(t){t('<div class="rl__header">'),t('<span class="rl__title">'+r+"</span>"),t("</div>")}))}});return K.register([{id:"none",name:"",grammar:{main:[]}},G(),W(),X(),U(),(et=S(X(),{id:"xml",name:"XML",alias:[]}),et.grammar.main.unshift([o,/<\?[\s\S]*?\?>/]),et)]),K.compose(nt),K}));
//# sourceMappingURL=ryuseilight-components.min.js.map
