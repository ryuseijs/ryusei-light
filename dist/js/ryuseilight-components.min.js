/*!
 * RyuseiLight.js
 * Version  : 1.0.2
 * License  : MIT
 * Copyright: 2020 Naotoshi Fujita
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).RyuseiLight=e()}(this,(function(){"use strict";var t="\n",e="keyword",n="comment",i="selector",r="prop",o="cdata",a="prolog",s="string",u="number",c="function",l="operator",f="bracket",p="delimiter",d="space",h="text";function m(t){return null!==t&&"object"==typeof t}function v(t){return Array.isArray(t)}function g(t){return"string"==typeof t}function y(t){return void 0===t}function b(t){return t instanceof HTMLElement}function _(t){return v(t)?t:[t]}function S(t,e){_(e).forEach((function(e){e&&t.classList.add(e)}))}function x(t,e){e=_(e);for(var n=0;n<e.length;n++)t.appendChild(e[n])}function k(t,e){if(t)for(var n=Object.keys(t),i=0;i<n.length;i++)e(t[n[i]],n[i])}function w(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return n.forEach((function(e){m(e)&&k(e,(function(n,i){y(e[i])||(t[i]=e[i])}))})),t}function F(t,e){if(g(e))return t.getAttribute(e)||"";m(e)&&k(e,(function(e,n){t.setAttribute(n,String(e))}))}function A(t,e){return void 0===e&&(e=document),e.querySelector(t)}function L(t,e){k(e,(function(e,n){t.style[n]=String(e)}))}function E(t,e){return"<"+(e||"div")+' class="'+t.join(" ")+'">'}function z(t,e){if(y(e))return t.textContent;t.textContent=e}function C(t,e){if(void 0===e&&(e=""),!t)throw new Error(e)}var T="ryuseilight";function R(t,e){return t.charAt(0)===e}var j=!y(/x/.sticky),O=function(){function e(t){this.depth=0,this.language=t,this.init(t)}var n=e.prototype;return n.init=function(t){var e=this;k(t.grammar,(function(n,i){t.grammar[i]=e.merge(t,n)})),k(t.use,this.init.bind(this))},n.merge=function(t,e){var n=this;return e.reduce((function(e,i){var r=i[0],o=i[1];if(R(r,"#")&&!o){var a=t.grammar[r.slice(1)];C(a),e.push.apply(e,n.merge(t,a))}else{var s=o.toString().match(/[gimsy]*$/)[0].replace(/[gy]/g,""),u=o.source+(j?"":"|()");k(t.source,(function(t,e){u=u.replace(new RegExp("%"+e,"g"),t.source)})),i[1]=new RegExp(u,(j?"y":"g")+s),e.push(i)}return e}),[])},n.tokenizeBy=function(t,e,n){var i=0,r=0;t:for(;i<t.length;){for(var o=0;o<n.length;o++){var a=n[o],s=a[1],u=a[2];s.lastIndex=i;var c=s.exec(t);if(c&&c[0]){if(r<i&&this.push([h,t.slice(r,i)]),"@back"===u){r=i;break t}if(r=i+=this.handle(c,e,a)||1,"@break"===u){this.depth--;break t}continue t}}i++}return r<i&&this.push([h,t.slice(r)]),i},n.push=function(e){C(this.depth>=0);for(var n,i=e[0],r=0,o=e[1];(n=o.indexOf(t,r))>-1;)r<n&&this.lines[this.index].push([i,o.slice(r,n),this.depth]),r=n+1,this.lines[++this.index]=[];(o=o.slice(r))&&this.lines[this.index].push([i,o,this.depth])},n.handle=function(t,e,n){var i=n[0],r=0;if(i){var o=t[0];if("@debug"===n[3]&&console.log(o,n),R(i,"@")){C(e.use);var a=e.use[i.slice(1)];return C(a),this.tokenizeBy(o,a,a.grammar.main)}if(R(i,"#")){var s=e.grammar[i.slice(1)];return C(s),"@rest"===n[2]&&(o=t.input.slice(t.index),this.depth++),this.tokenizeBy(o,e,s)}r=o.length,this.push([i,o])}return r},n.tokenize=function(t){return this.lines=[[]],this.index=0,this.tokenizeBy(t,this.language,this.language.grammar.main),this.lines},e}(),$=function(){function t(){this.handlers={}}var e=t.prototype;return e.on=function(t,e,n){void 0===n&&(n=10);var i=this.handlers[t]=this.handlers[t]||[];i.push({callback:e,priority:n}),i.sort((function(t,e){return t.priority-e.priority}))},e.emit=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];(this.handlers[t]||[]).forEach((function(t){t.callback.apply(t,n)}))},e.destroy=function(){this.handlers={}},t}(),D=T,H="rl__body",N="rl__code",B="is-active",M={},q=function(){function e(t,e,n,i){void 0===i&&(i={}),this.lines=[],this.event=new $,this.lines=t,this.info=e,this.root=n,this.options=i,this.init()}e.compose=function(t){k(t,(function(t,e){M[e]=t}))};var n=e.prototype;return n.init=function(){var t=this,e=this.lines;if(e.length){var n=e[e.length-1];n.length&&(1!==n.length||n[0][1].trim())||e.pop()}k(M,(function(e){e(t)})),this.event.emit("mounted")},n.renderLines=function(e){for(var n=this.event,i=this.options.span?"span":"code",r=0;r<this.lines.length;r++){var o=this.lines[r],a=["rl__line"];if(n.emit("line:open",e,a,r),e(E(a)),o.length)for(var s=0;s<o.length;s++){var u=o[s],c=["rl__token rl__"+u[0]];n.emit("token",u,c),e(E(c,i)),e(u[1].replace(/&/g,"&amp;").replace(/</g,"&lt;")+"</"+i+">")}else e(t);e("</div>"),n.emit("line:closed",e,r)}},n.html=function(t){var e=this.event,n="</div>",i="",r=function(t){i+=t};t&&(i+=E([D+" "+D+"--"+this.info.id],"pre"));var o=["rl__container"];e.emit("open",r,o),i+=E(o);var a=[H+(this.options.wrap?" rl__body--wrap":"")];return e.emit("body:open",r,a),i+=E(a),e.emit("code:open",r),i+=E([N]),this.renderLines(r),i+=n,e.emit("body:close",r),i+=n,e.emit("close",r),i+=n,e.emit("closed",r),t&&(i+="</pre>"),i},n.destroy=function(){this.event.emit("destroy"),this.event.destroy()},e}(),I=/[+-]?(\d+\.?\d*|\d*\.?\d+)([eE][+-]?\d+)?/,J=/\b(?:true|false)\b/,P=/[[\]{}()]/,G=/[ \t]+/,U=/'(?:\\'|.)*?'/,W=/"(?:\\"|.)*?"/,X=/\/\*[\s\S]*?\*\//,Y=/\/\/.*/,Z=/\b(?:break|catch|class|continue|do|else|extends|finally|for|function|if|implements|in|instanceof|interface|new|null|return|throw|try|while)\b/;function K(){return{id:"css",name:"CSS",grammar:{main:[["#common"],["#findSingleAtrule"],["#findBlock"]],findBlock:[["#block",/(?:(?![\t-\r ;\{\}\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])[\s\S])(?:(?![;\{\}])[\s\S])*\{[\s\S]*?\}/,"@rest"]],findSingleAtrule:[["#atrule",/@(?:(?![;\{])[\s\S])+?;/]],findAtrule:[["#atrule",/@(?:(?![;\{])[\s\S])*?(?=[;\{])/]],findSelector:[["#selector",/(?:(?![\t-\r ;\{\}\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])[\s\S])[\s\S]*?(?=\{)/]],common:[[s,/(["'])[\s\S]*?(?:(?!\\)[\s\S])\1/],[n,X],[d,G]],block:[["#inner",/{/,"@rest"],[f,/}/,"@break"],["#findAtrule"],["#findSelector"],[d,G]],inner:[[f,/{/],["#common"],["#findBlock"],["#props"],["#findAtrule"],["",/}/,"@back"]],atrule:[["#common"],["#url",/\burl\(/,"@rest"],[d,G],["atrule",/[^\s();]+/],[p,/[:;,]/],["#paren",/\(/,"@rest"]],paren:[[f,/^\(/],["#common"],["#paren",/\(/,"@rest"],[f,/\)/,"@break"],["#props"]],selector:[["#common"],[l,/[>+~]/],[f,/[[\]()]/],[p,/=/],[i,/::?\S+/],[i,/[\W\d]\S+/],["tag",/\b[a-z]+|\*/i],[i,/\S+/]],url:[["#common"],[c,/^url/],[f,/\(/],[s,/[^)]+/],[f,/\)/,"@break"]],props:[[r,/[a-z0-9-_\xA0-\uFFFF]+(?=:)/i],["#url",/\burl\(/,"@rest"],[c,/\b[\w-]+(?=\()\b/],[e,/!important|\b(?:initial|inherit|unset)/],[r,/[a-z0-9-]+(?=:)/],[u,/#([0-9a-f]{6}|[0-9a-f]{3})/i],[u,/\bU\+[0-9a-f?-]+/i],[u,/[+-]?(\d+\.?\d*|\d*\.?\d+)/],[p,/[:;,]/],["#paren",/\(/,"@rest"],[f,/[[\])]/],[d,G]]}}}function Q(){return{id:"javascript",name:"JavaScript",alias:["js"],source:{func:/[_$a-z\xA0-\uFFFF][_$a-z0-9\xA0-\uFFFF]*/},grammar:{main:[[s,U],[s,W],["#backtick",/`/,"@rest"],[n,X],[n,Y],["regexp",/\/(\[.*[^\\]?]|\\\/|.)+?\/[gimsuy]*/],[e,Z],[e,/\b(?:as|async|await|case|catch|const|debugger|default|delete|enum|export|from|import|let|package|private|protected|public|super|switch|static|this|typeof|undefined|var|void|with|yield)\b/],[e,/\b((get|set)(?=\s+%func))/i],["class",/\b[A-Z][\w$]*\b/],[c,/%func(?=\s*\()/i],["boolean",J],["decorator",/@[^\s(@]+/],["identifier",/\b[a-z_$][\w$]*\b/],[u,I],[l,/=>/],[l,/\+[+=]?|-[-=]?|\*\*?=?|[/%^]=?|&&?=?|\|\|?=?|\?\??=?|<<?=?|>>>=?|>>?=?|[!=]=?=?|[~:^]/],[f,P],[p,/[;.,]+/],[d,G]],backtick:[[s,/^`/],[s,/(\$[^{]|\\[$`]|[^`$])+/],["#expression",/\${/,"@rest"],[s,/`/,"@break"]],expression:[[p,/^\${/],[p,/}/,"@break"],["#main"]]}}}function V(t){void 0===t&&(t={});var e=(t.script||Q)(),i=(t.style||K)(),r=[o,/<!\[CDATA\[[\s\S]*\]\]>/i];return e.grammar.main.unshift(r),i.grammar.main.unshift(r),{id:"html",alias:["markup"],name:"HTML",use:{script:e,style:i},grammar:{main:[[n,/<!\x2D\x2D[\s\S]*?\x2D\x2D>/],[a,/<!DOCTYPE[\s\S]*?>/i],r,["#script",/<script[\s\S]*?>[\s\S]*?<\/script>/],["#style",/<style[\s\S]*?>[\s\S]*?<\/style>/],["#tag",/<[\s\S]*?>/],["entity",/&[\da-z]+;|&#\d+;/i],[d,G]],cdata:[[o,/<!\[CDATA\[[\s\S]*\]\]>/i]],script:[["#tag",/^<script[\s\S]*?>/],["#cdata"],["@script",/[\s\S]+(?=<\/script>)/],["#tag",/<\/script>/]],style:[["#tag",/^<style[\s\S]*?>/],["@style",/[\s\S]+(?=<\/style>)/],["#tag",/<\/style>/]],tag:[["#attr",/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+[\s\S]+(?=[\t-\r \/>\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/],["tag",/[^\s/<>"'=]+/],[f,/[<>]/],[p,/[/]/]],attr:[[d,G],["value",/(['"])(\\\1|.)*?\1/],[p,/[/=]/],["attr",/[^\s/>"'=]+/]]}}}var tt={},et=function(){function t(t){this.renderers=[],this.options=w({},t)}t.register=function(t){_(t).forEach((function(t){var e=t.id;e&&!tt[e]&&(t.alias||[]).concat(e).forEach((function(e){tt[e]=new O(t)}))}))},t.tokenize=function(e,n){return t.getLexer(n).tokenize(e)},t.has=function(t){return!!tt[t]},t.getLexer=function(e){return tt.none||t.register({id:"none",name:"",grammar:{main:[]}}),tt[e]||tt.none};var e=t.prototype;return e.getRenderer=function(e,n,i){var r=(i=w({},this.options,i)).language,o=t.getLexer(r).language,a=o.name,s=o.id;return new q(t.tokenize(e,r),{name:a,id:s},n,i)},e.apply=function(t,e){for(var n=g(t)?document.querySelectorAll(t):[t],i=0;i<n.length;i++){var r=n[i];if(b(r)){var o=w({},e,{language:F(r,"data-rl-language")||void 0}),a=this.getRenderer(z(r),r,o),s=r instanceof HTMLPreElement;s&&S(r,[D,D+"--"+a.info.id]),r.innerHTML=a.html(!s),a.event.emit("applied",r),this.renderers.push(a)}}},e.html=function(t,e){return C(g(t),"Invalid code."),this.getRenderer(t,null,e).html(!0)},e.destroy=function(){this.renderers.forEach((function(t){t.destroy()}))},t}();et.compose=q.compose;var nt="data-rl-active-lines";function it(t,e,n){var i="rl__figcaption";t('<figcaption class="'+i+" "+i+(n?"--bottom":"--top")+'">'),t("<span>"+e+"</span>"),t("</figcaption>")}var rt={html:"Copy",activeHtml:"Done",duration:1e3,ariaLabel:"Copy code to clipboard",position:"topRight"};function ot(t,e){var n,i=function(t,e,n){var i=document.createElement(t);return e&&S(i,e),n&&x(n,i),i}("textarea");i.textContent=t,L(i,{position:"absolute",left:"-99999px"}),x(document.body,i),i.focus(),i.select();try{document.execCommand("copy")}catch(t){alert("Failed to copy."),n=!0}document.body.removeChild(i),n||e()}var at={addedSymbol:"+",deletedSymbol:"-"};function st(t,e,n,i){t.indexOf(n)>-1?i.push("is-added"):e.indexOf(n)>-1&&i.push("is-deleted")}var ut="rl__gutter__row";var ct,lt=Object.freeze({__proto__:null,ActiveLines:function(t){var e=t.event,n=t.root,i=t.options,r=n&&function(t){var e=F(t,nt);if(e)try{return JSON.parse(e)}catch(t){n=t.message,console.error("[ryuseilight] "+n)}var n}(n)||i.activeLines;if(v(r)){var o=function(t){var e=[];return t.forEach((function(t){v(t)||(t=[t,t]);for(var n=(+t[0]||1)-1,i=(+t[1]||1)-1,r=n;r<=i;r++)e[r]=B})),e}(r);e.on("gutter:row:open",(function(t,e,n){o[n]&&e.push(o[n])})),e.on("line:open",(function(t,e,n){o[n]&&e.push(o[n])}))}},Caption:function(t){var e=t.event,n=t.root,i=t.options,r=n&&F(n,"data-rl-caption");if(r||i.caption){var o=i.caption,a=w({},m(o)?o:null),s=a.position,u=a.html,c=r||u||(g(o)?o:"");if(c){var l="bottom"===s;e.on("open",(function(t){t('<figure class="rl__figure">'),l||it(t,c)})),e.on("closed",(function(t){l&&it(t,c,!0),t("</figure>")}))}}},Copy:function(e){var n=e.lines,i=e.event,r=e.options;if(r.copy){var o=w({},rt,m(r.copy)?r.copy:{}),a="rl__button__label";r.tools=o.position,i.on("tools:"+o.position,(function(t){t('<button type="button" class="rl__button rl__copy" aria-label="'+o.ariaLabel+'">'),t('<span class="'+a+" "+a+'--inactive">'+o.html+"</span>"),t('<span class="'+a+" "+a+'--active">'+o.activeHtml+"</span>"),t("</button>")})),i.on("applied",(function(e){var r=A(".rl__copy",e),a=n.map((function(t){return t.map((function(t){return t[1]})).join("")})).join(t);if(r){var s=function(){!function(t,e,n){var i=function(){n&&function(t,e){S(t,B);var n="_rlTimer";t[n]&&clearTimeout(t[n]);t[n]=setTimeout((function(){t.classList.remove(B)}),e)}(e,n)};navigator.clipboard?navigator.clipboard.writeText(t).then(i).catch((function(){return ot(t,i)})):ot(t,i)}(a,r,o.duration)};r.addEventListener("click",s),i.on("destroy",(function(){r.removeEventListener("click",s)}))}}))}},Diff:function(e){var n=e.event,i=e.lines,r=e.options;if(r.diff){r.gutter=!0;var o=w({},at,m(r.diff)?r.diff:null),a=[],s=[];i.forEach((function(t,e){if(t.length){var n,i=t[0][1];R(i,o.addedSymbol)?(a.push(e),n=!0):R(i,o.deletedSymbol)&&(s.push(e),n=!0),n&&function(t,e){var n=e[0],i=n[0],r=n[1];if(t)1===r.length?e.shift():e[0]=[i,r.slice(1)];else{var o=[d," "];1===r.length?e[0]=o:(e[0]=[i,r.slice(1)],e.unshift(o))}}(o.removeSymbols,t)}})),(a.length||s.length)&&(n.on("line:open",(function(t,e,n){st(a,s,n,e)})),n.on("gutter:row:open",(function(t,e,n){st(a,s,n,e)})),n.on("gutter:row:opened",(function(e,n){var i=t;a.indexOf(n)>-1?i=o.addedSymbol:s.indexOf(n)>-1&&(i=o.deletedSymbol),e('<span class="rl__diff">'+i+"</span>")}),20),n.on("lineNumber:open",(function(t,e,n,i){i.skip=s.indexOf(n)>-1})))}},Gutter:function(t){var e=t.lines,n=t.event,i=t.root,r=t.options;n.on("mounted",(function(){var t,o,a;r.gutter&&(n.on("open",(function(t,e){e.push("has-gutter")})),n.on("code:open",(function(t){t('<div class="rl__gutter" aria-hidden="true">');for(var i=0;i<e.length;i++){var r=[ut];n.emit("gutter:row:open",t,r,i),t('<div class="'+r.join(" ")+'">'),n.emit("gutter:row:opened",t,i),t("</div>")}t("</div>")})),i&&"undefined"!=typeof window&&(window.addEventListener("resize",(t=s,o=100,function(){a||(a=setTimeout((function(){t(),a=null}),o))})),s(),n.on("destroy",(function(){window.removeEventListener("resize",s)}))));function s(){var t=i.getElementsByClassName(ut),e=A("."+N,i);if(t.length&&e)for(var n=0;n<e.children.length;n++){var r=t[n],o=e.children[n];b(r)&&r.clientHeight!==o.clientHeight&&L(r,{height:o.clientHeight+"px"})}}}))},LanguageName:function(t){var e=t.event,n=t.info,i=t.options,r=n.name;if(i.languageName&&r){var o="topLeft"===i.languageName?"topLeft":"topRight";i.overlay=i.overlay||{},i.overlay[o]=!0,e.on("overlay:"+o,(function(t){t('<span class="rl__name">'+n.name+"</span>")}))}},LineNumbers:function(e){var n=e.root,i=e.event,r=e.options,o=n?F(n,"data-rl-line-numbers"):"",a=""===o?+r.lineNumbers:+o;if(a||0===a){r.gutter=!0;var s=Math.floor(a)-1;i.on("gutter:row:opened",(function(e,n){var r=["rl__line-number"],o={skip:!1,content:n+1+s};i.emit("lineNumber:open",e,r,n,o),o.skip&&(o.content=t,s--),e('<span class="'+r.join(" ")+'">'+o.content+"</span>")}))}},Overlay:function(t){var e=t.event,n=t.options;e.on("mounted",(function(){var t=n.overlay,i=void 0===t?{}:t,r=n.tools,o=i.topRight,a=i.topLeft;[o=o||"topRight"===r,a=a||"topLeft"===r].forEach((function(t,n){t&&(r&&function(t,e){var n=e?"Left":"Right";t.on("overlay:top"+n,(function(e){e('<span class="rl__tools">'),t.emit("tools:top"+n,e),e("</span>")}))}(e,1===n),function(t,e){var n="rl__overlay";t.on("close",(function(i){i('<div class="'+n+" "+n+"--top-"+(e?"left":"right")+'">'),t.emit("overlay:top"+(e?"Left":"Right"),i),i("</div>")}))}(e,1===n))})),(o||a)&&e.on("open",(function(t,e){e.push("has-top-overlay")}))}))}});return et.register([{id:"none",name:"",grammar:{main:[]}},Q(),V(),K(),(ct=w(V(),{id:"xml",name:"XML",alias:[]}),ct.grammar.main.unshift([a,/<\?[\s\S]*?\?>/]),ct)]),et.compose(lt),et}));
//# sourceMappingURL=ryuseilight-components.min.js.map
